# 요구사항 명세서 (Requirements Spec)

## 1. 기능 요구사항

### 1.1 사용자 관리 (User API)

#### FR-001: 개발용 간편 로그인
- **설명**: 이메일과 닉네임만으로 빠르게 로그인하여 개발 및 테스트를 진행합니다.
- **우선순위**: 높음
- **입력**: 이메일, 닉네임
- **출력**: JWT 토큰, 사용자 정보
- **처리**: 
  - 이메일로 기존 사용자 조회
  - 없으면 새 사용자 생성 (provider: "dev")
  - JWT 토큰 발급 (HS256, 24시간 유효)
- **화면**: LoginScreen

#### FR-002: OAuth2 소셜 로그인
- **설명**: Google, Naver 계정으로 로그인합니다.
- **우선순위**: 중간 (향후 구현)
- **입력**: OAuth2 인증 코드
- **출력**: JWT 토큰, 사용자 정보
- **처리**:
  - OAuth2 Provider로 리다이렉트
  - 인증 코드 수신 및 사용자 정보 추출
  - 사용자 생성/업데이트
  - JWT 토큰 발급
- **화면**: LoginScreen

#### FR-003: 자동 로그인
- **설명**: 저장된 JWT 토큰으로 자동 로그인합니다.
- **우선순위**: 높음
- **입력**: 저장된 JWT 토큰
- **출력**: 사용자 정보
- **처리**:
  - SharedPreferences에서 토큰 로드
  - 토큰 유효성 검증
  - 사용자 정보 조회
- **화면**: SplashScreen → HomeScreen

#### FR-004: 프로필 조회
- **설명**: 현재 로그인한 사용자의 프로필 정보를 조회합니다.
- **우선순위**: 높음
- **입력**: JWT 토큰
- **출력**: 사용자 정보 (ID, 이메일, 닉네임, 자기소개, 프로필 이미지)
- **처리**: JWT에서 user_id 추출 후 데이터베이스 조회
- **화면**: MyScreen, ProfileEditScreen

#### FR-005: 프로필 수정
- **설명**: 사용자 프로필 정보를 수정합니다.
- **우선순위**: 중간
- **입력**: 닉네임, 자기소개, 프로필 이미지 URL
- **출력**: 업데이트된 사용자 정보
- **처리**: 데이터베이스 업데이트, updated_at 자동 갱신
- **화면**: ProfileEditScreen

#### FR-006: 회원 탈퇴
- **설명**: 사용자 계정을 삭제합니다 (Soft Delete).
- **우선순위**: 낮음
- **입력**: JWT 토큰
- **출력**: 성공 메시지
- **처리**: 
  - 사용자 상태를 DELETED로 변경
  - 연관 카탈로그/아이템은 유지 (향후 정책 결정)
- **화면**: ProfileEditScreen

### 1.2 카탈로그 관리 (Catalog API)

#### FR-007: 카탈로그 생성
- **설명**: 새로운 수집 카탈로그를 생성합니다.
- **우선순위**: 높음
- **입력**: 제목, 설명, 카테고리, 태그, 공개 여부, 썸네일 URL
- **출력**: 생성된 카탈로그 정보
- **처리**:
  - UUID 생성
  - JWT에서 user_id 추출
  - 데이터베이스 저장
  - 초기 수집률 0% 설정
- **화면**: AddScreen, CatalogEditScreen

#### FR-008: 내 카탈로그 목록 조회
- **설명**: 사용자가 소유한 모든 카탈로그를 조회합니다.
- **우선순위**: 높음
- **입력**: JWT 토큰
- **출력**: 카탈로그 목록 (제목, 설명, 수집률, 아이템 수 포함)
- **처리**:
  - JWT에서 user_id 추출
  - 해당 사용자의 카탈로그 조회
  - 각 카탈로그의 수집률 실시간 계산
- **화면**: HomeScreen

#### FR-009: 공개 카탈로그 목록 조회
- **설명**: 다른 사용자가 공개한 카탈로그를 탐색합니다.
- **우선순위**: 중간
- **입력**: 카테고리 필터 (선택)
- **출력**: 공개 카탈로그 목록
- **처리**:
  - visibility="public"인 카탈로그 조회
  - 자신의 카탈로그 제외
- **화면**: ExploreScreen

#### FR-010: 카탈로그 상세 조회
- **설명**: 특정 카탈로그의 상세 정보를 조회합니다.
- **우선순위**: 높음
- **입력**: 카탈로그 ID
- **출력**: 카탈로그 정보, 아이템 목록, 수집률
- **처리**:
  - 카탈로그 정보 조회
  - 소속 아이템 목록 조회
  - 수집률 계산
- **화면**: CatalogDetailScreen

#### FR-011: 카탈로그 수정
- **설명**: 카탈로그 정보를 수정합니다.
- **우선순위**: 중간
- **입력**: 카탈로그 ID, 수정할 필드
- **출력**: 업데이트된 카탈로그 정보
- **처리**:
  - 소유자 확인
  - 데이터베이스 업데이트
  - updated_at 자동 갱신
- **화면**: CatalogEditScreen

#### FR-012: 카탈로그 삭제
- **설명**: 카탈로그를 삭제합니다.
- **우선순위**: 중간
- **입력**: 카탈로그 ID
- **출력**: 성공 메시지
- **처리**:
  - 소유자 확인
  - 연관 아이템도 함께 삭제
  - 데이터베이스에서 제거
- **화면**: CatalogDetailScreen

#### FR-013: 카탈로그 저장 (복사)
- **설명**: 다른 사용자의 공개 카탈로그를 내 컬렉션에 저장합니다.
- **우선순위**: 중간
- **입력**: 원본 카탈로그 ID
- **출력**: 복사본 카탈로그 ID
- **처리**:
  - 원본 카탈로그 조회
  - 자신의 카탈로그인지 확인 (자신 것은 저장 불가)
  - 이미 저장했는지 확인 (중복 방지)
  - 카탈로그 완전 복사본 생성
  - 모든 아이템 복사 (owned=False로 초기화)
  - user_catalogs 테이블에 관계 저장
- **화면**: CatalogDetailScreen (공개 카탈로그 조회 시)

### 1.3 아이템 관리 (Catalog API)

#### FR-014: 아이템 생성
- **설명**: 카탈로그에 새 아이템을 추가합니다.
- **우선순위**: 높음
- **입력**: 카탈로그 ID, 이름, 설명, 이미지 URL, 사용자 정의 필드
- **출력**: 생성된 아이템 정보
- **처리**:
  - UUID 생성
  - 카탈로그 소유자 확인
  - 데이터베이스 저장
  - user_item_status 생성 (owned=False)
- **화면**: ItemAddScreen

#### FR-015: 아이템 목록 조회
- **설명**: 특정 카탈로그의 모든 아이템을 조회합니다.
- **우선순위**: 높음
- **입력**: 카탈로그 ID, 보유 여부 필터 (선택)
- **출력**: 아이템 목록 (이름, 설명, 이미지, 보유 여부 포함)
- **처리**:
  - 카탈로그의 아이템 조회
  - 사용자별 보유 상태 조인 (user_item_status)
  - 필터 적용 (보유만/미보유만)
- **화면**: CatalogDetailScreen

#### FR-016: 아이템 상세 조회
- **설명**: 특정 아이템의 상세 정보를 조회합니다.
- **우선순위**: 중간
- **입력**: 아이템 ID
- **출력**: 아이템 정보, 사용자 정의 필드
- **처리**:
  - 아이템 정보 조회
  - 사용자별 보유 상태 조회
- **화면**: ItemDetailScreen

#### FR-017: 아이템 수정
- **설명**: 아이템 정보를 수정합니다.
- **우선순위**: 중간
- **입력**: 아이템 ID, 수정할 필드
- **출력**: 업데이트된 아이템 정보
- **처리**:
  - 카탈로그 소유자 확인
  - 데이터베이스 업데이트
  - updated_at 자동 갱신
- **화면**: ItemDetailScreen

#### FR-018: 아이템 보유 상태 토글 (핵심 기능)
- **설명**: 아이템의 보유 여부를 토글합니다.
- **우선순위**: 높음
- **입력**: 아이템 ID
- **출력**: 업데이트된 보유 상태
- **처리**:
  - 카탈로그 소유자 확인
  - user_item_status 조회/생성
  - owned 필드 토글 (True ↔ False)
  - 수집률 자동 재계산
- **화면**: CatalogDetailScreen, ItemDetailScreen

#### FR-019: 아이템 삭제
- **설명**: 아이템을 삭제합니다.
- **우선순위**: 중간
- **입력**: 아이템 ID
- **출력**: 성공 메시지
- **처리**:
  - 카탈로그 소유자 확인
  - 연관 user_item_status도 함께 삭제
  - 데이터베이스에서 제거
- **화면**: ItemDetailScreen

### 1.4 파일 관리 (Catalog API)

#### FR-020: 이미지 업로드
- **설명**: 이미지 파일을 업로드합니다.
- **우선순위**: 중간
- **입력**: 이미지 파일 (multipart/form-data)
- **출력**: 업로드된 파일 URL
- **처리**:
  - 파일 검증 (크기, 형식)
  - 사용자별 디렉토리에 저장
  - 파일 URL 반환
- **화면**: CatalogEditScreen, ItemAddScreen

#### FR-021: 이미지 서빙
- **설명**: 업로드된 이미지를 제공합니다.
- **우선순위**: 중간
- **입력**: 파일 URL
- **출력**: 이미지 파일
- **처리**: 정적 파일 서빙
- **화면**: 모든 화면 (이미지 표시)

### 1.5 수집률 계산 (Catalog API)

#### FR-022: 실시간 수집률 계산
- **설명**: 카탈로그의 수집률을 실시간으로 계산합니다.
- **우선순위**: 높음
- **입력**: 카탈로그 ID, 사용자 ID
- **출력**: 수집률 (0-100%)
- **처리**:
  - 전체 아이템 수 조회
  - 보유 아이템 수 조회 (user_item_status에서 owned=True)
  - 수집률 = (보유 수 / 전체 수) × 100
- **화면**: HomeScreen, CatalogDetailScreen

## 2. 비기능 요구사항

### 2.1 성능 요구사항

#### NFR-001: 응답 시간
- **User API**: 평균 응답 시간 50ms 이하
- **Catalog API**: 평균 응답 시간 100ms 이하
- **Flutter**: 화면 전환 300ms 이하

#### NFR-002: 동시 사용자
- **개발 환경**: 10명 동시 접속 지원
- **프로덕션 환경**: 1,000명 동시 접속 지원 (향후)

#### NFR-003: 데이터베이스 성능
- **인덱스**: user_id, catalog_id, item_id에 인덱스 설정
- **쿼리 최적화**: N+1 문제 방지, 조인 최소화

### 2.2 보안 요구사항

#### NFR-004: 인증
- **JWT 토큰**: HS256 알고리즘, 24시간 유효기간
- **토큰 저장**: 클라이언트에서 안전한 저장소 사용
- **HTTPS**: 프로덕션 환경에서 필수

#### NFR-005: 권한
- **데이터 격리**: 사용자별 데이터 완전 분리
- **소유자 확인**: 카탈로그/아이템 수정 시 소유자 검증
- **공개 범위**: visibility 설정에 따른 접근 제어

#### NFR-006: 데이터 검증
- **입력 검증**: Pydantic, Bean Validation으로 데이터 검증
- **SQL Injection 방지**: ORM 사용 (JPA, SQLAlchemy)
- **XSS 방지**: JSON 응답, 입력 데이터 이스케이프

### 2.3 가용성 요구사항

#### NFR-007: 서비스 가용성
- **개발 환경**: 99% 가용성
- **프로덕션 환경**: 99.9% 가용성 (향후)

#### NFR-008: 에러 처리
- **에러 응답**: 일관된 JSON 형식
- **에러 로깅**: 모든 에러 자동 로깅
- **사용자 피드백**: 명확한 에러 메시지 제공

### 2.4 확장성 요구사항

#### NFR-009: 수평 확장
- **마이크로서비스**: 각 서비스 독립적으로 확장 가능
- **로드 밸런싱**: ALB를 통한 트래픽 분산 (향후)
- **Auto Scaling**: 트래픽에 따른 자동 확장 (향후)

#### NFR-010: 데이터 확장
- **데이터베이스**: 향후 RDS, DynamoDB로 마이그레이션
- **파일 저장**: 향후 S3로 마이그레이션
- **캐싱**: 향후 Redis 도입

### 2.5 유지보수성 요구사항

#### NFR-011: 코드 품질
- **레이어 분리**: 명확한 책임 분리
- **주석**: 주요 로직에 한글 주석
- **네이밍**: 명확하고 일관된 변수/함수명

#### NFR-012: 로깅
- **User API**: Spring Boot 기본 로깅
- **Catalog API**: 모든 요청/응답 자동 로깅
- **Flutter**: developer.log로 API 호출 추적

#### NFR-013: 문서화
- **API 문서**: Swagger UI (FastAPI), Javadoc (Spring Boot)
- **코드 주석**: 주요 클래스/함수에 설명 주석
- **README**: 각 서비스별 실행 방법 문서화

### 2.6 호환성 요구사항

#### NFR-014: 플랫폼 지원
- **웹**: Chrome, Safari, Firefox 최신 버전
- **모바일**: iOS 13+, Android 8+
- **데스크톱**: macOS, Windows, Linux

#### NFR-015: 브라우저 호환성
- **반응형 디자인**: 다양한 화면 크기 지원
- **UTF-8 인코딩**: 한글 등 유니코드 문자 정상 처리

## 3. 화면 기능 매핑

| 화면 | 기능 요구사항 | 설명 |
|------|--------------|------|
| SplashScreen | FR-003 | 자동 로그인 |
| LoginScreen | FR-001, FR-002 | 개발용 로그인, OAuth2 로그인 |
| HomeScreen | FR-008, FR-022 | 내 카탈로그 목록, 수집률 표시 |
| ExploreScreen | FR-009 | 공개 카탈로그 탐색 |
| AddScreen | FR-007 | 카탈로그 생성 |
| CatalogDetailScreen | FR-010, FR-012, FR-013, FR-015, FR-018, FR-022 | 카탈로그 상세, 삭제, 저장, 아이템 목록, 보유 토글, 수집률 |
| CatalogEditScreen | FR-007, FR-011, FR-020 | 카탈로그 생성/수정, 이미지 업로드 |
| ItemAddScreen | FR-014, FR-020 | 아이템 생성, 이미지 업로드 |
| ItemDetailScreen | FR-016, FR-017, FR-018, FR-019 | 아이템 상세, 수정, 보유 토글, 삭제 |
| MyScreen | FR-004 | 프로필 조회 |
| ProfileEditScreen | FR-004, FR-005, FR-006 | 프로필 조회/수정, 회원 탈퇴 |

## 4. 제약 사항

### 4.1 기술적 제약

- **개발 환경**: macOS 기반 개발
- **데이터베이스**: 개발 단계에서 H2, SQLite 사용
- **컨테이너**: Catalog API만 Docker 사용
- **네트워크**: 로컬 환경에서 직접 연결

### 4.2 비즈니스 제약

- **MVP 범위**: 핵심 기능만 구현
- **사용자 수**: 초기에는 소규모 사용자 대상
- **데이터 용량**: 개발 단계에서 제한적

### 4.3 일정 제약

- **개발 기간**: 2025년 9월 5일 ~ 12월 6일
- **우선순위**: 높음 기능 우선 구현
- **향후 확장**: 중간/낮음 기능은 추후 구현

## 5. 가정 사항

- 사용자는 인터넷 연결이 가능한 환경에서 사용합니다.
- 사용자는 최신 브라우저 또는 모바일 OS를 사용합니다.
- 이미지 파일은 10MB 이하입니다.
- 한 카탈로그당 아이템 수는 1,000개 이하입니다.
- 한 사용자당 카탈로그 수는 100개 이하입니다.
